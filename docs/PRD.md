# 커피 주문 앱

## 1. 프로젝트 개요

### 1.1 프로젝트명
    커피 주문 앱

### 1.2 프로젝트 목적
    사용자가 커피 메뉴를 주문하고 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱 (입문자 학습을 위해 서버 및 클라이언트 소스 전반에 상세한 한글 주석 포함)

### 1.3 개발 범위
    - 주문하기 화면(메뉴 선택 및 장바구니 기능)
    - 관리자 화면(재고 관리 및 주문 상태 관리)
    - 데이타를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택
    - Frontend: React, HTML, CSS, JavaScript
    - Backend: Node.js, Express
    - Database: PostgreSQL

## 3. 기본 사항
    - 프런트엔드와 백엔드를 따로 개발
    - 기본적인 웹 기술만 사용
    - 학습 목적이므로 실제 결제 기능은 제외 (단, 관리자용 사용자 관리 기능은 포함)
    - **메뉴는 커피 메뉴만 있음**
    - **데이터 영속성**: PostgreSQL 데이터베이스를 사용하여 서버 재시작 후에도 주문 및 재고 데이터를 영구적으로 유지함.
    - **코드 가독성**: 프로그래밍 입문자도 쉽게 코드를 이해할 수 있도록 모든 주요 소스 코드(`index.js`, `OrderScreen.jsx` 등)에 단계별 한글 주석을 상세히 작성함.

## 4. 화면별 상세 요구사항

### 4.1 주문하기 화면 (Customer Order Page)
사용자가 메뉴를 확인하고 장바구니에 담아 주문을 진행하는 화면입니다.

#### 4.1.1 레이아웃 구성
- **헤더 (Header)**
    - 배경색: 반투명 화이트 (글래스모피즘 효과, backdrop-filter 적용)
    - 로고 및 네비게이션 색상: 다크 에스프레소 (#3d2b1f)
    - 좌측: 서비스 로고 ('COZY')
    - 우측: 네비게이션 메뉴 ('MENU', 'ADMIN')
    - 현재 위치에 따라 활성화된 메뉴 하단에 부드러운 하이라이트 효과 적용
- **레이아웃**
    - 전체 컨텐츠는 중앙 정렬 (Max-width: 1200px)
    - **디자인 컨셉**: "Premium Espresso & Warm Cream" - 브라운과 베이지 톤의 조화, 부드러운 그림자와 글래스 카드 스타일 적용
- **메뉴 리스트 영역**
    - 격자(Grid) 형태로 메뉴 카드들이 배치됨 (반투명 유리 질감 효과)
- **장바구니 영역 (Bottom Fixed Footer)**
    - 화면 하단 전체에 고정된 푸터(Footer) 형태로 존재
    - **구조 개편**: 왼쪽(장바구니 타이틀 및 세로 주문 목록), 오른쪽(총합계 금액 및 수직 배치된 주문하기 버튼)
    - 본문 하단에 장바구니 높이만큼의 유동적 여백(Padding)을 두어 마지막 메뉴까지 가림 없이 노출됨

#### 4.1.3 모바일 반응형 최적화 (Mobile Optimization)
- **적응형 레이아웃**: 화면 너비가 768px 이하인 모바일 기기에서 레이아웃이 미디어 쿼리에 따라 자동 최적화됨
- **헤더 및 네비게이션 최적화**: 
    - 모바일에서 메뉴 링크 간격과 폰트 크기를 축소하여 텍스트 겹침 방지
    - 좁은 화면에서도 모든 메뉴가 한눈에 들어오도록 유연한 레이아웃 구성
- **장바구니 바 개선**:
    - 가로 배치에서 세로 배치(Stack) 구조로 전환하여 텍스트 겹침 방지
    - 패딩 및 폰트 크기 축소를 통해 화면 점유율 최적화
- **관리자 대시보드 최적화**:
    - **통계 요약 카드**: 4열 가로 배치를 모바일에서 **2x2 그리드**로 전환하여 "Completed" 등 모든 카드가 잘림 없이 노출됨
    - **경계선 스타일**: 모바일 배열에 맞춰 경계선(Border) 위치를 재조정하여 시각적 정합성 유지
- **그리드 조정**: 메뉴 리스트를 모바일에서 1열 배치로 변경하여 가독성 증대

#### 4.1.2 주요 기능 요구사항
- **메뉴 카드 (Menu Card)**
    - **이미지**: 메뉴 상단에 **AI 기반 고해상도의 프리미엄 이미지** 표시
        - 모든 이미지는 "Premium Espresso & Warm Cream" 테마에 맞춰 생성됨
        - 이미지 영역은 라운드 처리 및 `object-fit: cover`를 적용하여 카드 디자인과 일체감 형성
    - **메뉴 정보**: 메뉴명(예: 아메리카노(ICE)), 가격(예: 4,000원), 간단한 설명 표시
    - **옵션 선택**: 체크박스를 통해 옵션 추가 가능
        - 샷 추가 (+500원)
        - 시럽 추가 (0원)
    - **담기 버튼**: 클릭 시 선택한 옵션과 함께 메뉴가 장바구니에 추가됨
        - 추가 성공 시 토스트(Toast) 메시지로 사용자에게 알림
- **장바구니 (Cart)**
    - **목록 표시**: 메뉴명, 선택 옵션, 수량, 개별 합계 금액을 한 줄씩 세로로 정렬
    - **수량 관리**: 
        - 동일 메뉴(동일 옵션 포함)는 합산하여 표시
        - 장바구니 내 각 아이템 옆에 작은 `+`, `-` 버튼을 제공하여 즉시 수량 변경 가능
    - **총액 계산**: 담긴 모든 메뉴의 총 금액을 "총금액 : 00,000원" 형태로 우측 상단에 강조 표시
- **주문하기 기능**
    - **버튼 디자인**: 다크 에스프레소 배경의 라운드 버튼으로 우측 하단 배치
    - **재고 검증**: 주문 시 실시간 재고 확인 및 부족 시 경고 안내
    - **주문 처리**: 주문 데이터 생성, 재고 차감, 장바구니 비우기 및 초기화 프로세스 진행
    - **결과 알림 (Premium Modal)**: 주문 성공 시 브라우저 알림창 대신 체크 애니메이션이 포함된 **프리미엄 커스텀 모달**을 표시하여 사용자에게 성공적인 피드백 제공

### 4.2 관리자 화면 (Admin Dashboard Page)
관리자와 매니저가 주문 현황을 파악하고, 메뉴의 재고를 관리하며, 주문 상태를 제어하는 화면입니다.

#### 4.2.1 레이아웃 구성
- **헤더 (Header)**
    - 주문하기 화면과 동일하며, 권한(Admin, Manager)이 있는 경우 '관리자' 및 '메뉴 관리' 메뉴가 활성화됨
- **관리자 대시보드 (Dashboard)**
    - 현재 운영 현황을 한눈에 볼 수 있는 요약 정보창
- **재고 현황 (Inventory Management)**
    - 메뉴별 현재 재고 수량을 확인하고 수정할 수 있는 영역
- **주문 현황 (Order Management)**
    - 시간순으로 나열된 주문 목록 및 상태 변경 영역

#### 4.2.2 주요 기능 요구사항
- **대시보드 요약 정보**
    - **총 주문 수**: 당일 발생한 전체 주문 건수
    - **주문 접수**: 아직 조리가 시작되지 않은 주문 건수
    - **제조 중**: 현재 조리 중인 주문 건수
    - **제조 완료**: 조리가 완료되어 픽업 대기 중인 주문 건수
- **재고 현황 관리**
    - **수량 및 상태 표시**: 각 메뉴별 현재 남아있는 재고 수량 표시
        - **정상**: 재고 5개 이상
        - **주의**: 재고 5개 미만 (주황색 강조)
        - **품절**: 재고 0개 (빨간색 강조)
    - **재고 수정**: `+` 및 `-` 버튼을 통해 재고 수량을 1단위로 즉시 증감 가능
- **주문 현황 및 상태 제어**
    - **주문 상세 정보**: 주문 일자 및 시간, 메뉴명(옵션 포함), 수량, 가격 표시
    - **상태 처리 버튼**: 현재 주문의 다음 단계로 상태를 전환하는 버튼 (눈에 잘 띄는 **Solid 스타일** 배지 적용)
        - '제조 시작' 클릭 시: '주문 접수' -> '제조 중'
        - '제조 완료' 클릭 시: '제조 중' -> '제조 완료'
    - **취소 기능**: '주문 접수' 상태인 주문에 대해 **'취소하기'** 버튼 제공
        - **디자인**: 조작 실수 방지를 위해 상대적으로 무채색(Muted) 톤 적용
        - **안전 장치**: 클릭 시 경고 아이콘과 재고 복구 안내가 포함된 **커스텀 확인 모달** 노출
    - **레이아웃**: 모든 상태 버튼과 취소 버튼은 한 줄(Single Line)로 깔끔하게 정렬됨
    - **상태 흐름**: 주문 접수 -> 제조 중 -> 제조 완료 또는 주문 접수 -> 취소됨

### 4.3 사용자 관리 화면 (User Management Page)
시스템을 이용하는 계정을 관리하는 화면으로, **Admin(관리자) 권한 소유자만 접근 가능**합니다.

#### 4.3.1 레이아웃 및 디자인
- **컨테이너 정렬**: `container` 클래스를 적용하여 데스크톱 환경에서 좌우 여백을 확보하고 시각적 균형 유지
- **통일된 헤더**: 다른 관리자 페이지와 동일한 섹션 라벨('Management') 및 타이틀 스타일 적용

#### 4.3.2 주요 기능 요구사항
- **커스텀 등록/수정 모달**: 사용자 정보를 입력하거나 수정할 때 화면 전환 없이 나타나는 애니메이션 기반 모달 제공
- **커스텀 삭제 확인 모달**: 사용자 삭제 전 'Shield' 경고 아이콘과 함께 명확한 안내를 제공하는 확인 모달 노출
- **성공 알림 (Success Modal)**: 등록 또는 수정 작업이 완료되면 녹색 체크마크 아이콘과 함께 작업 완료를 알리는 전용 모달 표시

#### 4.3.3 모바일 반응형 최적화
- **헤더 최적화**: 좁은 화면에서 제목과 '새 사용자 추가' 버튼을 세로로 자동 정렬
- **카드 기반 레이아웃 (Card-based Layout)**: 
    - 모바일에서는 좁은 테이블 형태 대신, 정보를 한눈에 보기 편한 **카드 형태의 리스트**로 자동 전환
    - 사용자 ID, 역할, 가입일 등 주요 정보를 카드 내에 구조적으로 배치
- **터치 최적화 버튼**: 수정 및 삭제 버튼을 카드의 하단에 크게 배치하여 터치 조작 편의성 증대
- **레이아웃 상호 배타성**: 데스크톱 테이블과 모바일 카드가 브라우저 크기에 따라 명확하게 전환되어 중복 노출 방지
- **모달 적응형**: 모든 커스텀 모달의 너비를 모바일 화면 크기에 맞춰 가변적으로 조절 (최대 너비 95%)
- **풀 너비 버튼**: 모바일에서 확인 및 취소 버튼을 가로 전체 너비로 배치하여 조작 편의성 증대

## 5. 백엔드 및 데이터베이스 상세 요구사항

### 5.1 데이터 모델 (Data Model)

- **Menus (메뉴)**
    - ID: 고유 식별자
    - 이름 (name): 커피 메뉴 이름
    - 설명 (description): 메뉴에 대한 간단한 설명
    - 가격 (price): 기본 판매 가격
    - 이미지 경로 (image_url): `/americano.png` 등 `public` 폴더 내 이미지 경로
    - 재고 수량 (stock): 현재 판매 가능한 수량
- **Options (옵션)**
    - ID: 고유 식별자
    - 옵션 이름 (name): 옵션 명칭 (예: 샷 추가, 시럽 추가)
    - 옵션 가격 (price): 옵션 선택 시 추가되는 금액
    - 메뉴 ID (menu_id): 해당 옵션이 속한 메뉴 (Menus 테이블 참조)
- **Orders (주문)**
    - ID: 고유 식별자
    - 주문 일시 (created_at): 주문이 생성된 날짜와 시간
    - 총 금액 (total_price): 전체 주문 합계 금액
    - 주문 상태 (status): 현재 상태 (주문 접수 / 제조 중 / 제조 완료 / 취소됨)
    - 주문 내용 (items): 주문한 메뉴 리스트, 수량, 선택 옵션, 금액 등을 포함 (`order_items` 테이블과 조인하여 관리)

### 5.2 데이터 흐름 및 사용자 시나리오

1.  **메뉴 로드**: 사용자가 앱에 접속하면 시스템은 `Menus` 및 `Options` 데이터를 조회하여 화면에 표시합니다. 관리자 화면에는 특히 `stock` 정보를 함께 노출합니다.
2.  **장바구니 담기**: 사용자가 선택한 메뉴와 옵션 정보는 클라이언트 사이드의 장바구니에 임시 저장됩니다.
3.  **주문 생성**: 장바구니에서 '주문하기' 버튼을 클릭하면 주문 생성 API가 호출됩니다. 이때 주문 시간과 상세 내용이 `Orders` 테이블에 기록됩니다.
4.  **재고 차감**: 주문이 성공적으로 생성되면 관련 메뉴(`Menus`)의 재고 수량이 주문 수량만큼 감소합니다.
5.  **관리자 확인 및 상태 변경**: `Orders`에 저장된 정보는 관리자 화면의 '주문 현황' 목록에 표시됩니다. 관리자가 버튼을 클릭하여 상태를 업데이트합니다.
6.  **주문 취소 및 재고 복구**: 관리자가 주문을 취소할 경우, 해당 주문에 포함된 아이템들의 수량만큼 해당 메뉴의 **재고(`stock`)가 자동으로 복구(Restocking)** 되어 데이터 무결성을 유지합니다.

### 5.3 API 설계 및 배포 환경 대응 (API & Deployment)

- **메뉴 조회 (GET /api/menu)**: 
    - 데이터베이스에서 모든 커피 메뉴와 각 메뉴별 옵션 목록을 불러옵니다.
    - **강화된 로깅**: 에러 발생 시 상세 원인(예: DB 연결 오류 메시지)을 클라이언트에 전달하여 원격 환경 트러블슈팅을 용이하게 함.
- **주문 생성 (POST /api/orders)**: 장바구니 데이터를 받아 정보를 저장하고, 메뉴 재고를 실시간으로 차감합니다.
- **환경 변수 기반 주소 관리**: 
    - 프론트엔드(`VITE_API_URL`)와 백엔드(`DATABASE_URL`) 간의 통신 주소를 환경 변수로 관리하여 로컬과 Render.com 배포 환경에 즉시 대응 가능.
- **DB 보안 연결 (SSL/TLS)**: 
    - Render.com PostgreSQL 등 클라우드 DB의 필수 보안 요건인 SSL 연결을 지원합니다.
    - **조건부 SSL 설정**: 로컬 개발 환경(`localhost`)에서는 SSL을 비활성화하고, 원격 배포 환경에서만 SSL을 활성화하여 개발 편의성과 보안을 동시에 확보함.
- **원격 DB 초기화 도구**: 
    - `schema.sql`을 원격 DB에 직접 주입할 수 있는 초기화 스크립트(`init_remote_db.js`)를 제공하며, 이 역시 환경에 따른 조건부 SSL 설정을 따름.

## 6. 권한 시스템 (Roles & Permissions)

| 기능 | Admin (관리자) | Manager (매니저) | Staff (직원) |
| :--- | :---: | :---: | :---: |
| 주문하기 / 장바구니 | O | O | O |
| 관리자 대시보드 (주문 관리) | O | O | X |
| 메뉴 및 재고 관리 | O | O | X |
| 사용자 및 권한 관리 | O | X | X |